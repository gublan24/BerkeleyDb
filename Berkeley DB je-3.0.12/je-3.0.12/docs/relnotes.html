<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>

<head>
  <title>Berkeley DB Java Edition Release Notes</title>
  <link rel="stylesheet" href="sleepycat-idoc.css" type="text/css">
</head>

<body>

<div class="docMain">
<center>
<h1>Berkeley DB Java Edition<br>
Release Notes</h1>
</center>

<!-- Note: RELEASE_VERSION and DATE are set by ant -->
<p class="releaseInfo">3.0.12, May 25, 2006</p>
<p>These release notes contain:</p>
<ul>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#new">New in this Release</a></li>
</ul>

<h2><a name="overview">Overview</a></h2>
<p>
Berkeley DB Java Edition (JE) is a 100% pure Java implementation of
Berkeley DB. It implements a transactional store model based on a
B+Tree access method.
</p>
<p>The documentation set for JE includes:</p>
<ul>
<li>JE's capabilities and features are described in the <a
 href="http://www.sleepycat.com/jedocs/GettingStartedGuide/index.html">Getting
Started with Berkeley DB Java Edition</a> guide. That document also
introduces the JE API set.</li>

<li>For a description of how to use JE and the new Direct Persistence Layer, see the <a
 href="http://www.sleepycat.com/jedocs/PersistenceAPI/index.html">Getting
Started with the Direct Persistence Layer</a> guide.</li>

<li>For a description of how to use JE and the Sleepycat Java Collections
API, see the <a href="http://www.sleepycat.com/jedocs/collections/tutorial/index.html">collections
tutorial</a>.</li>

<li>For an overview on using transactions, see <a 
 href="http://www.sleepycat.com/jedocs/TransactionGettingStarted/index.html">Writing
 Transactional Applications with Berkeley DB, Java Edition</a></li>

<li>For a complete description of the JE API set, see the <a
href="http://www.sleepycat.com/jedocs/java/index.html">Javadoc</a>.</li>
</ul>

<h2><a name="new">New in this Release</a></h2>

<p>This is release 3.0.12 of Berkeley DB Java Edition, and the
second release in the JE 3.0 line. JE 3.0.12 contains bug fixes to the
Direct Persistence Layer beta released in JE 3.0.11, and are described
in the first section of <a
href="http://www.sleepycat.com/je_update/3.0.12/if.3.0.12.html">the
change log page</a> for this release.
<p>
In JE 3.0.11 we introduced a new Plain Old Java Object (POJO)-based
persistent object model which we called the Persistence API. Since
then, we've decided to rename this API to the Direct Persistence
Layer, to avoid confusion with the EJB3 Java Persistence API.
<p>
Key changes since version JE 2.1.30
are described below; the complete list of changes can also be found in <a
href="http://www.sleepycat.com/je_update/3.0.12/if.3.0.12.html">the
change log page</a>.<br>
</p>
<p>Note: If you are using Mac OS X, please be aware of the following
issue. Java version 1.4.2 on Mac OS X reports the wrong value for
Runtime.maxMemory. JE calculates the default cache size as a percentage
of maxMemory.&nbsp; Because of this, for Java 1.4.2 on Mac OS X only,
JE will assume that the Java maxMemory value is 64 MB.&nbsp; With the
default je.maxMemoryPercent configuration parameter (60%) the default
JE cache size will be approximately 38 MB.&nbsp; This default is fixed
-- it does not change if the Java memory size is different than 64
MB.&nbsp; To specify a different JE cache size, you must explicitly set
the je.maxMemory configuration property.&nbsp; The je.maxMemory
property can be specified in the je.properties file or by calling
EnvironmentConfig.setCacheSize.
</p>
<h3>Log File On-Disk Format Changes:</h3>
<ol>
<li>JE 3.0.11 has moved to on-disk file format 4.
<br>
<br>
The change is <i>forward compatible</i> in that JE files created with
release 2.1.30 and earlier can be read when opened with JE 3.0.11.
The change is <i>not backward compatible</i> in that files created
with JE 3.0.11 cannot be read by earlier releases. Note that if an earlier
environment is opened read/write, a new log file is written by JE
3.0.11 and the environment can no longer be read by earlier
releases. 
</li>
<br>
<li>
An upgrade problem was inadvertently introduced between JE 2.0.90,
which was released in Nov 1, 2005 and the following JE 2.1.34 release in January
2006. The problem does not apply to you if you have an environment
created with JE 2.0.90 or earlier, and have since successfully opened
it with JE 2.1.30. Likewise, a 2.0.90 and earlier environment that has
been closed cleanly with Environment.close() will not encounter this
problem, nor will most environments that have more than 30 Mb of data.
Please read the 
<a
href="http://www.sleepycat.com/je_update/3.0.12/if.3.0.12.html">the
change log page</a> for the full description.
</li>
</ol>

<h3>New Features:</h3>
<ol>
<li>
A new Direct Persistence Layer adds a built-in Plain Old Java Object (POJO)-based
persistent object model, which provides support for complex object models
without compromises in performance. [#13894]

<p>No object bindings are needed when using the Direct Persistence Layer and Java
annotations can be used to define persistent classes and index keys.  Bindings
are generated automatically based on annotations, and bytecode enhancement is
used to avoid the overhead of reflection.</p>

<p>Starting points for using the Direct Persistence Layer are:
<a href="http://www.sleepycat.com/jedocs/PersistenceAPI/index.html">Getting
Started with the Direct Persistence Layer</a> and the
<a href="http://www.sleepycat.com/jedocs/java/com/sleepycat/persist/package-summary.html">com.sleepycat.persist</a> package specification.</p>

<p>This is a beta release of the Direct Persistence Layer.  Please be aware of the
following limitations of the beta release:</p>
    <ul>
    <li>Although class evolution is described in the API documentation, it is
    not supported in the beta release.  While using the beta release, if you
    change your persistent class field definitions then you will need to delete
    any existing environments that were created using the old class
    definitions.
    </li>
    <br>
    <li>Class evolution will be fully supported in the final release of the
    Direct Persistence Layer.  When upgrading to the final release, you may be required
    to convert your data files.
    </li>
    <br>
    <li>The beta release does not support using the
    <code>java.math.BigInteger</code> or <code>java.math.BigDecimal</code>
    classes as persistent types.  These classes will be supported as simple
    types in the final release, and may be used as primary and secondary keys.
    </li>
    <br>
    <li>The beta release of the Direct Persistence Layer requires compiling and
    deploying with Java 1.5 or greater. Support for Java 1.4 may be added in a
    future release, based on user demand.
    </li>
    </ul>
</li>
<br>
<li>
A new "deferred write" database mode provides better performance for
temporary databases or database which rapidly modify data by reducing
the amount of I/O incurred. In a normal durable database, every new
version of a data record is written to disk; in deferred write mode,
JE avoids disk I/O until cache is exceeded or Database.sync() is
called. See the Getting Started Guide, Chapter 3 (Databases) for more
information. [#13936]
</li>
<br>
<li>
<code>com.sleepycat.je.util.DbBackup</code> is a new helper class
which simplified backups by managing JE background activity in an open
environment. See the Getting Started Guide, Chapter 7 (Backing up and
Restoring Berkeley DB Java Edition Applications) and the Javadoc for
DbBackup for more information. [#14022]
</li>
<br>
<li>
The <code>com.sleepycat.collections</code> package is now fully compatible with
the Java Collections framework. In previous releases,
<code>Collections.size()</code> was not supported, and collection iterators had
to be explicitly closed.  These incompatibilities have been addressed to
provide full interoperability with other Java libraries that use the
Java Collections Framework interfaces.  [#14154] [#12986]

<p>Please be aware of the following changes:</p>
    <ul>
    <li>In prior releases, because <code>Collections.size()</code> was not
    supported, certain operations that worked with standard collections were
    not possible with stored collections.  For example, a stored collection
    could not be passed to the constructor of a standard collection such as
    <code>ArrayList</code>, <code>HashSet</code>, etc, because these
    constructors call <code>Collection.size()</code>.  Using these constructors
    is now possible.
    </li>
    <br>
    <li>In prior releases, because iterators had to be closed, stored
    collections could not be passed to external library methods that obtained
    an iterator, such as <code>Collection.containsAll</code>,
    <code>Collection.addAll</code>, etc.  Using such methods is now possible.
    Using the Java 1.5 "foreach" statement with stored collections is also now
    possible.
    </li>
    <br>
    <li>The changes to the collections API are compatible with prior releases,
    with one exception:  The <code>Iterator</code> object returned by the
    <code>StoredCollection.iterator()</code> method can no longer be explicitly
    cast to <code>StoredIterator</code> because a different implementation
    class is now used for iterators.  If you depend on the
    <code>StoredIterator</code> class, you must now call
    <code>StoredCollection.storedIterator()</code> instead.  Note that
    the <code>StoredIterator.close(Iterator)</code> static method <em>is</em>
    compatible with the new iterator implementation, so no changes are
    necessary if you are using that method to close iterators.
    </li>
    <br>
    <li>In order to provide iterators that do not require closing, the
    <code>Collection.iterator</code> method now returns iterators that retrieve
    records in blocks.  An underlying <code>Cursor</code> is <em>not</em> kept
    open by the iterator.  The block of records is cached and returned by
    the iterator as required.  When a record is needed outside the cached
    block, another block of records is retrieved.  If desired, you can
    configure the number of records per block by calling the new method
    <code>StoredCollection.setIteratorBlockSize</code>.
    </li>
    <br>
    <li>The performance of the <code>Collection.size</code> method depends on
    the size of the underlying database.  All non-duplicate records in the
    database are enumerated by this method, bringing them into memory if they
    are not already cached.  To maximize performance and concurrency, no locks
    are taken on records as they are counted.
    </li>
    <br>
    <li>Note that if other threads are adding or removing records while the
    <code>size()</code> method is executing, the size returned may be
    incorrect, because the size method does not lock the database.  This
    behavior is compatible with the standard <code>Collection.size</code>
    interface contract.
    </li>
    </ul>
</li>
</ol>
<h3>General Environment Changes:</h3>
<p>
See the <a href="http://www.sleepycat.com/je_update/3.0.12/if.3.0.12.html">
change log</a> contains the complete and detailed description of
all bug fixes.
</p>
<font size="1"><a href="sleepycat/legal.html">Copyright (c) 1996-2006</a>
<a href="http://www.sleepycat.com">Sleepycat Software, Inc.</a> - All
rights reserved.</font>
</div>
<!-- end docMain -->
</body>
</html>
